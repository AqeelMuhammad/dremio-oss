#
# Copyright (C) 2017-2019 Dremio Corporation
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

---
 -
  description: "JUST SELECT"
  input: "SELECT ^"
  output: "SELECT QUERY: SELECT ^ "
 -
  description: "JUST SELECT *"
  input: "SELECT * ^"
  output: "SELECT QUERY: SELECT * ^ "
 -
  description: "JUST SELECT * FROM "
  input: "SELECT * FROM ^"
  output:
   - "SELECT QUERY: SELECT * FROM ^ "
   - "  FROM: FROM ^ "
   - "    CATALOG PATHS: [^ ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "BASIC QUERY"
  input: "SELECT * FROM EMP ^"
  output:
   - "SELECT QUERY: SELECT * FROM EMP ^ "
   - "  FROM: FROM EMP ^ "
   - "    CATALOG PATHS: [EMP ^ ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "WITH CLAUSES"
  input: "SELECT * FROM EMP WHERE EMP.age = 42 ^"
  output:
   - "SELECT QUERY: SELECT * FROM EMP WHERE EMP . age = 42 ^ "
   - "  FROM: FROM EMP "
   - "    CATALOG PATHS: [EMP ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "Subquery + Cursor Inside"
  input:
   - "SELECT (SELECT ^ FROM EMP) "
   - "FROM DEPT"
  output:
   - "SELECT QUERY: SELECT ( SELECT ^ FROM EMP ) FROM DEPT "
   - "  SELECT QUERY: SELECT ^ FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  FROM: FROM DEPT "
   - "    CATALOG PATHS: [DEPT ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "Subquery + Cursor Outside"
  input:
   - "SELECT ^, (SELECT * FROM EMP) "
   - "FROM DEPT"
  output:
   - "SELECT QUERY: SELECT ^ , ( SELECT * FROM EMP ) FROM DEPT "
   - "  SELECT QUERY: SELECT * FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  FROM: FROM DEPT "
   - "    CATALOG PATHS: [DEPT ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "Subquery with function"
  input:
   - "SELECT DEPTNO, ("
   - "SELECT MAX(EMP.SAL), ^ FROM EMP"
   - ") FROM DEPT"
  output:
   - "SELECT QUERY: SELECT DEPTNO , ( SELECT MAX ( EMP . SAL ) , ^ FROM EMP ) FROM DEPT "
   - "  SELECT QUERY: SELECT MAX ( EMP . SAL ) , ^ FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  FROM: FROM DEPT "
   - "    CATALOG PATHS: [DEPT ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "Middle Query"
  input: "SELECT DEPTNO, (SELECT ^ , (SELECT * FROM SALGRADE) FROM EMP) FROM DEPT"
  output:
   - "SELECT QUERY: SELECT DEPTNO , ( SELECT ^ , ( SELECT * FROM SALGRADE ) FROM EMP ) FROM DEPT "
   - "  SELECT QUERY: SELECT ^ , ( SELECT * FROM SALGRADE ) FROM EMP "
   - "    SELECT QUERY: SELECT * FROM SALGRADE "
   - "      FROM: FROM SALGRADE "
   - "        CATALOG PATHS: [SALGRADE ,,]"
   - "        JOIN CONDITIONS: []"
   - ""
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  FROM: FROM DEPT "
   - "    CATALOG PATHS: [DEPT ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "Subqueries projection"
  input:
   - "SELECT "
   - "\t(SELECT * FROM EMP), "
   - "\t(SELECT * FROM EMP), "
   - "\t(SELECT * FROM EMP) "
   - "FROM DEPT ^"
  output:
   - "SELECT QUERY: SELECT ( SELECT * FROM EMP ) , ( SELECT * FROM EMP ) , ( SELECT * FROM EMP ) FROM DEPT ^ "
   - "  SELECT QUERY: SELECT * FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT * FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT * FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  FROM: FROM DEPT ^ "
   - "    CATALOG PATHS: [DEPT ^ ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "Subqueries from"
  input:
   - "SELECT * "
   - "FROM (SELECT * FROM EMP) as emp, (SELECT * FROM DEPT) as dept ^"
  output:
   - "SELECT QUERY: SELECT * FROM ( SELECT * FROM EMP ) as emp , ( SELECT * FROM DEPT ) as dept ^ "
   - "  SELECT QUERY: SELECT * FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT * FROM DEPT "
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  FROM: FROM ( SELECT * FROM EMP ) as emp , ( SELECT * FROM DEPT ) as dept ^ "
   - "    CATALOG PATHS: [( SELECT * FROM EMP ) as emp ,,( SELECT * FROM DEPT ) as dept ^ ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "Subqueries both"
  input:
   - "SELECT "
   - "\t(SELECT * FROM emp), "
   - "\t(SELECT * FROM emp), "
   - "\t(SELECT * FROM emp) "
   - "FROM (SELECT * FROM EMP) as emp, (SELECT * FROM DEPT) as dept ^"
  output:
   - "SELECT QUERY: SELECT ( SELECT * FROM emp ) , ( SELECT * FROM emp ) , ( SELECT * FROM emp ) FROM ( SELECT * FROM EMP ) as emp , ( SELECT * FROM DEPT ) as dept ^ "
   - "  SELECT QUERY: SELECT * FROM emp "
   - "    FROM: FROM emp "
   - "      CATALOG PATHS: [emp ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT * FROM emp "
   - "    FROM: FROM emp "
   - "      CATALOG PATHS: [emp ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT * FROM emp "
   - "    FROM: FROM emp "
   - "      CATALOG PATHS: [emp ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT * FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT * FROM DEPT "
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  FROM: FROM ( SELECT * FROM EMP ) as emp , ( SELECT * FROM DEPT ) as dept ^ "
   - "    CATALOG PATHS: [( SELECT * FROM EMP ) as emp ,,( SELECT * FROM DEPT ) as dept ^ ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "SET QUERY (UNION)"
  input:
   - "SELECT DEPTNO, ^ FROM DEPT"
   - " UNION"
   - "SELECT EMPNO FROM EMP"
  output:
   - "SET QUERY: SELECT DEPTNO , ^ FROM DEPT UNION SELECT EMPNO FROM EMP "
   - "  SELECT QUERY: SELECT DEPTNO , ^ FROM DEPT "
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT EMPNO FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
 -
  description: "SET QUERY (EXCEPT)"
  input:
   - "SELECT DEPTNO, ^ FROM DEPT"
   - " EXCEPT"
   - "SELECT EMPNO FROM EMP"
  output:
   - "SET QUERY: SELECT DEPTNO , ^ FROM DEPT EXCEPT SELECT EMPNO FROM EMP "
   - "  SELECT QUERY: SELECT DEPTNO , ^ FROM DEPT "
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT EMPNO FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
 -
  description: "SET QUERY (MINUS)"
  input:
   - "SELECT DEPTNO, ^ FROM DEPT"
   - " MINUS"
   - "SELECT EMPNO FROM EMP"
  output:
   - "SET QUERY: SELECT DEPTNO , ^ FROM DEPT MINUS SELECT EMPNO FROM EMP "
   - "  SELECT QUERY: SELECT DEPTNO , ^ FROM DEPT "
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT EMPNO FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
 -
  description: "SET QUERY (INTERSECT)"
  input:
   - "SELECT DEPTNO, ^ FROM DEPT"
   - " INTERSECT"
   - "SELECT EMPNO FROM EMP"
  output:
   - "SET QUERY: SELECT DEPTNO , ^ FROM DEPT INTERSECT SELECT EMPNO FROM EMP "
   - "  SELECT QUERY: SELECT DEPTNO , ^ FROM DEPT "
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT EMPNO FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
 -
  description: "SET QUERY FIRST"
  input:
   - "SELECT DEPTNO, ^ FROM DEPT"
   - " UNION"
   - "SELECT EMPNO FROM EMP"
   - " UNION"
   - "SELECT GRADE FROM SALGRADE"
  output:
   - "SET QUERY: SELECT DEPTNO , ^ FROM DEPT UNION SELECT EMPNO FROM EMP UNION SELECT GRADE FROM SALGRADE "
   - "  SELECT QUERY: SELECT DEPTNO , ^ FROM DEPT "
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT EMPNO FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT GRADE FROM SALGRADE "
   - "    FROM: FROM SALGRADE "
   - "      CATALOG PATHS: [SALGRADE ,,]"
   - "      JOIN CONDITIONS: []"
 -
  description: "SET QUERY MIDDLE"
  input:
   - "SELECT DEPTNO FROM DEPT"
   - " UNION"
   - "SELECT EMPNO, ^ FROM EMP"
   - " UNION"
   - "SELECT GRADE FROM SALGRADE"
  output:
   - "SET QUERY: SELECT DEPTNO FROM DEPT UNION SELECT EMPNO , ^ FROM EMP UNION SELECT GRADE FROM SALGRADE "
   - "  SELECT QUERY: SELECT DEPTNO FROM DEPT "
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT EMPNO , ^ FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT GRADE FROM SALGRADE "
   - "    FROM: FROM SALGRADE "
   - "      CATALOG PATHS: [SALGRADE ,,]"
   - "      JOIN CONDITIONS: []"
 -
  description: "SET QUERY LAST"
  input:
   - "SELECT DEPTNO FROM DEPT"
   - " UNION"
   - "SELECT EMPNO FROM EMP"
   - " UNION"
   - "SELECT GRADE, ^ FROM SALGRADE"
  output:
   - "SET QUERY: SELECT DEPTNO FROM DEPT UNION SELECT EMPNO FROM EMP UNION SELECT GRADE , ^ FROM SALGRADE "
   - "  SELECT QUERY: SELECT DEPTNO FROM DEPT "
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT EMPNO FROM EMP "
   - "    FROM: FROM EMP "
   - "      CATALOG PATHS: [EMP ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT GRADE , ^ FROM SALGRADE "
   - "    FROM: FROM SALGRADE "
   - "      CATALOG PATHS: [SALGRADE ,,]"
   - "      JOIN CONDITIONS: []"
 -
  description: "Complex multiline query"
  input:
   - "SELECT DEPTNO FROM DEPT"
   - "UNION"
   - "SELECT DEPTNO, NAME,   (SELECT MAX(EMP.SAL), ^"
   - "    FROM EMP JOIN DEPT ON EMP.DEPTNO = DEPT.DEPTNO"
   - "    WHERE EMP.DEPTNO = DEPT.DEPTNO  ) AS MAX_SAL_IN_DEPTNO"
   - "FROM DEPT"
   - "UNION"
   - "SELECT GRADE FROM SALGRADE"
  output:
   - "SET QUERY: SELECT DEPTNO FROM DEPT UNION SELECT DEPTNO , NAME , ( SELECT MAX ( EMP . SAL ) , ^ FROM EMP JOIN DEPT ON EMP . DEPTNO = DEPT . DEPTNO WHERE EMP . DEPTNO = DEPT . DEPTNO ) AS MAX_SAL_IN_DEPTNO FROM DEPT UNION SELECT GRADE FROM SALGRADE "
   - "  SELECT QUERY: SELECT DEPTNO FROM DEPT "
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT DEPTNO , NAME , ( SELECT MAX ( EMP . SAL ) , ^ FROM EMP JOIN DEPT ON EMP . DEPTNO = DEPT . DEPTNO WHERE EMP . DEPTNO = DEPT . DEPTNO ) AS MAX_SAL_IN_DEPTNO FROM DEPT "
   - "    SELECT QUERY: SELECT MAX ( EMP . SAL ) , ^ FROM EMP JOIN DEPT ON EMP . DEPTNO = DEPT . DEPTNO WHERE EMP . DEPTNO = DEPT . DEPTNO "
   - "      FROM: FROM EMP JOIN DEPT ON EMP . DEPTNO = DEPT . DEPTNO "
   - "        CATALOG PATHS: [EMP ,,DEPT ,,]"
   - "        JOIN CONDITIONS: [EMP . DEPTNO = DEPT . DEPTNO ,]"
   - ""
   - "    FROM: FROM DEPT "
   - "      CATALOG PATHS: [DEPT ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT GRADE FROM SALGRADE "
   - "    FROM: FROM SALGRADE "
   - "      CATALOG PATHS: [SALGRADE ,,]"
   - "      JOIN CONDITIONS: []"
 -
  description: "Cursor after subselect"
  input: "SELECT * FROM (SELECT * FROM ORGS), (SELECT * FROM SALES), ^"
  output:
   - "SELECT QUERY: SELECT * FROM ( SELECT * FROM ORGS ) , ( SELECT * FROM SALES ) , ^ "
   - "  SELECT QUERY: SELECT * FROM ORGS "
   - "    FROM: FROM ORGS "
   - "      CATALOG PATHS: [ORGS ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  SELECT QUERY: SELECT * FROM SALES "
   - "    FROM: FROM SALES "
   - "      CATALOG PATHS: [SALES ,,]"
   - "      JOIN CONDITIONS: []"
   - ""
   - "  FROM: FROM ( SELECT * FROM ORGS ) , ( SELECT * FROM SALES ) , ^ "
   - "    CATALOG PATHS: [( SELECT * FROM ORGS ) ,,( SELECT * FROM SALES ) ,,^ ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "Statement with nested selects in FROM"
  input: "SELECT * FROM (SELECT (SELECT (SELECT 1, 2, 3)^, 4)) FROM EMP)"
  output:
   - "SELECT QUERY: SELECT * FROM ( SELECT ( SELECT ( SELECT 1 , 2 , 3 ) ^ , 4 ) ) FROM EMP ) "
   - "  SELECT QUERY: SELECT ( SELECT ( SELECT 1 , 2 , 3 ) ^ , 4 ) ) FROM EMP "
   - "    SELECT QUERY: SELECT ( SELECT 1 , 2 , 3 ) ^ , 4 ) "
   - "      SELECT QUERY: SELECT 1 , 2 , 3 "
   - "  FROM: FROM ( SELECT ( SELECT ( SELECT 1 , 2 , 3 ) ^ , 4 ) ) FROM EMP ) "
   - "    CATALOG PATHS: [( SELECT ( SELECT ( SELECT 1 ,,2 ,,3 ) ^ ,,4 ) ) FROM EMP ) ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "Statement with nested selects in projection"
  input: "SELECT (SELECT (SELECT 1, 2, 3^), 4)) FROM TEST"
  output:
   - "SELECT QUERY: SELECT ( SELECT ( SELECT 1 , 2 , 3^ ) , 4 ) ) FROM TEST "
   - "  SELECT QUERY: SELECT ( SELECT 1 , 2 , 3^ ) , 4 ) "
   - "    SELECT QUERY: SELECT 1 , 2 , 3^ "
 -
  description: "Statement with open parenthesis recognized as part of the same scope"
  input: "SELECT COUNT(^ FROM EMP"
  output:
   - "SELECT QUERY: SELECT COUNT ( ^ FROM EMP "
   - "  FROM: FROM EMP "
   - "    CATALOG PATHS: [EMP ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "Cursor belongs to the succeeding scope if it points immediately before the scope keyword"
  input: "SELECT * FROM SALES ^SELECT name FROM EMP"
  output:
   - "SELECT QUERY: SELECT * FROM SALES ^ SELECT name FROM EMP "
   - "  FROM: FROM SALES ^ SELECT name FROM EMP "
   - "    CATALOG PATHS: [SALES ^ SELECT name FROM EMP ,,]"
   - "    JOIN CONDITIONS: []"
 -
  description: "SUBQUERY AT ROOT LEVEL"
  input: "(SELECT 1)^"
  output: "UNKNOWN: ( SELECT 1 ) ^ "
